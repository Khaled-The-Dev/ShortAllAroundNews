/**
 * Bundled by jsDelivr using Rollup v2.74.1 and Terser v5.15.1.
 * Original file: /npm/@supabase/supabase-js@2.2.3/dist/module/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{FunctionsClient as e}from"/npm/@supabase/functions-js@2.0.0/+esm";export{FunctionsError,FunctionsFetchError,FunctionsHttpError,FunctionsRelayError}from"/npm/@supabase/functions-js@2.0.0/+esm";import{PostgrestClient as t}from"/npm/@supabase/postgrest-js@1.1.1/+esm";import{RealtimeClient as s}from"/npm/@supabase/realtime-js@2.1.0/+esm";export*from"/npm/@supabase/realtime-js@2.1.0/+esm";import{StorageClient as n}from"/npm/@supabase/storage-js@2.1.0/+esm";import i,{Headers as a}from"/npm/cross-fetch@3.1.5/+esm";import{GoTrueClient as r}from"/npm/@supabase/gotrue-js@2.6.1/+esm";export*from"/npm/@supabase/gotrue-js@2.6.1/+esm";const o={"X-Client-Info":"supabase-js/2.2.3"};var h=function(e,t,s,n){return new(s||(s=Promise))((function(i,a){function r(e){try{h(n.next(e))}catch(e){a(e)}}function o(e){try{h(n.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}h((n=n.apply(e,t||[])).next())}))};const u=e=>{let t;return t=e||("undefined"==typeof fetch?i:fetch),(...e)=>t(...e)},l=(e,t,s)=>{const n=u(s),i="undefined"==typeof Headers?a:Headers;return(s,a)=>h(void 0,void 0,void 0,(function*(){var r;const o=null!==(r=yield t())&&void 0!==r?r:e;let h=new i(null==a?void 0:a.headers);return h.has("apikey")||h.set("apikey",e),h.has("Authorization")||h.set("Authorization",`Bearer ${o}`),n(s,Object.assign(Object.assign({},a),{headers:h}))}))};class c extends r{constructor(e){super(e)}}var d=function(e,t,s,n){return new(s||(s=Promise))((function(i,a){function r(e){try{h(n.next(e))}catch(e){a(e)}}function o(e){try{h(n.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}h((n=n.apply(e,t||[])).next())}))};const m={headers:o},p={schema:"public"},f={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},g={};class b{constructor(e,s,n){var i,a,r,o,h,u,c,d;if(this.supabaseUrl=e,this.supabaseKey=s,!e)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const b=e.replace(/\/$/,"");this.realtimeUrl=`${b}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${b}/auth/v1`,this.storageUrl=`${b}/storage/v1`;if(b.match(/(supabase\.co)|(supabase\.in)/)){const e=b.split(".");this.functionsUrl=`${e[0]}.functions.${e[1]}.${e[2]}`}else this.functionsUrl=`${b}/functions/v1`;const v=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,j=function(e,t){const{db:s,auth:n,realtime:i,global:a}=e,{db:r,auth:o,realtime:h,global:u}=t;return{db:Object.assign(Object.assign({},r),s),auth:Object.assign(Object.assign({},o),n),realtime:Object.assign(Object.assign({},h),i),global:Object.assign(Object.assign({},u),a)}}(null!=n?n:{},{db:p,realtime:g,auth:Object.assign(Object.assign({},f),{storageKey:v}),global:m});this.storageKey=null!==(a=null===(i=j.auth)||void 0===i?void 0:i.storageKey)&&void 0!==a?a:"",this.headers=null!==(o=null===(r=j.global)||void 0===r?void 0:r.headers)&&void 0!==o?o:{},this.auth=this._initSupabaseAuthClient(null!==(h=j.auth)&&void 0!==h?h:{},this.headers,null===(u=j.global)||void 0===u?void 0:u.fetch),this.fetch=l(s,this._getAccessToken.bind(this),null===(c=j.global)||void 0===c?void 0:c.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},j.realtime)),this.rest=new t(`${b}/rest/v1`,{headers:this.headers,schema:null===(d=j.db)||void 0===d?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new e(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new n(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},s){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return d(this,void 0,void 0,(function*(){const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i},a,r){const o={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new c({url:this.authUrl,headers:Object.assign(Object.assign({},o),a),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,fetch:r})}_initRealtimeClient(e){return new s(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,null==t?void 0:t.access_token,"CLIENT")}))}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===t?"SIGNED_OUT"!==e&&"USER_DELETED"!==e||(this.realtime.setAuth(this.supabaseKey),"STORAGE"==s&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=t?t:null),this.changedAccessToken=t)}}const v=(e,t,s)=>new b(e,t,s);export{b as SupabaseClient,v as createClient};export default null;
//# sourceMappingURL=/sm/47d440a74c4ab80a4995dcbf8e86d2ee4c02c222c6f8a638f56626398c7b20b5.map